# Анализ рейтинга слушателей на основе существующей архитектуры TutorAI

## Вариант 2: Расчет рейтинга без изменения базы данных

### Используемые сущности и поля (только существующие):

1. **Student** (Студент)

   - `student_id` - идентификатор
   - `is_active` - флаг активности
2. **Assignment** (Задания)

   - `student_id` - студент
   - `lesson_id` - урок
   - `status` - статус выполнения
   - `grade` - оценка
   - `deadline` - срок сдачи
   - `submitted_at` - дата отправки
3. **Meeting** (Занятия)

   - `stream_id` - поток
   - `lesson_id` - урок
   - `meeting_type` - тип занятия
   - `meeting_date` - дата занятия
4. **Schedule** (Расписание)

   - `stream_id` - поток
   - `lesson_id` - урок
   - `scheduled_date` - запланированная дата
   - `is_completed` - завершено ли занятие
5. **Stream** (Поток)

   - `stream_id` - идентификатор
   - `program_id` - программа курса
6. **CourseProgram** (Программа курса)

   - `program_id` - идентификатор
   - `total_hours` - общая длительность
7. **Lesson** (Урок)

   - `lesson_id` - идентификатор
   - `duration_hours` - длительность
8. **Module** (Модуль)

   - `module_id` - идентификатор
   - `duration_hours` - общая длительность

## Предлагаемая формула расчета рейтинга

### Компоненты рейтинга:

1. **Академическая успеваемость (60%):**

   ```
   Рейтинг_академический = (Средняя_оценка * Коэффициент_своевременности) * 0.6
   ```

   - Средняя оценка = Сумма(grade) / Количество заданий со статусом CHECKED или COMPLETED
   - Коэффициент своевременности =
     - 1.0 если submitted_at <= deadline
     - 0.8 если submitted_at > deadline и submitted_at <= deadline + 7 дней
     - 0.6 если submitted_at > deadline + 7 дней
2. **Прогресс по курсу (40%):**

   ```
   Рейтинг_прогресс = (Процент_пройденных_уроков * Коэффициент_посещаемости) * 0.4
   ```

   - Процент пройденных уроков = (Количество завершенных заданий / Общее количество уроков) * 100
   - Коэффициент посещаемости = Количество посещенных занятий / Общее количество занятий

### Определение посещенных занятий:

Посещенным считается занятие, для которого:

- Студент имеет задание по этому уроку со статусом SUBMITTED, CHECKED или COMPLETED
- Или занятие было запланировано в Schedule и отмечено как завершенное (is_completed = true)

## Преимущества данного подхода:

1. **Не требует изменений базы данных** - все необходимые поля уже есть
2. **Простота реализации** - можно создать SQL въю или функцию
3. **Быстрота расчета** - не требует сложных агрегаций
4. **Прозрачность** - легко понять логику расчета

## Ограничения данного подхода:

1. **Нет точной посещаемости** - используется прокси в виде выполненных заданий
2. **Нет учета активности** - не учитывается частота входов и взаимодействий
3. **Фиксированные веса** - нельзя настроить под разные курсы

## Вывод:

Данный подход позволяет быстро и без изменений реализовать систему рейтинга, основанную на двух ключевых метриках: академической успеваемости и прогресса по курсу. Это отличное решение для быстрого запуска системы рейтингов.
