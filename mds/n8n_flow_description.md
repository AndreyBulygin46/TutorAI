# üîÑ –û–ø–∏—Å–∞–Ω–∏–µ —Ñ–ª–æ—É n8n –¥–ª—è —Å–∏—Å—Ç–µ–º—ã —Ä–µ–π—Ç–∏–Ω–≥–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤

## üìã –û–±–∑–æ—Ä —Ñ–ª–æ—É

### –¶–µ–ª—å —Ñ–ª–æ—É

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞—Å—á–µ—Ç–∞ —Ä–µ–π—Ç–∏–Ω–≥–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤, –æ—Ç–±–æ—Ä–∞ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ Telegram.

### –ü–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å

- **–ó–∞–ø—É—Å–∫**: –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ –ø–æ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞–º –≤ 10:00 (MSK) (–ø–æ–∫–∞ —Ç–∞–∫ –≤ —Ç–µ—Å—Ç–µ)
- **–ü–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞**: –ü—Ä–µ–¥—ã–¥—É—â–∞—è –Ω–µ–¥–µ–ª—è (–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫-–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ)
- **–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏**: 2-3 –º–∏–Ω—É—Ç—ã

## üéØ –®–∞–≥–∏ —Ñ–ª–æ—É

### 1. **Cron Trigger** ‚è∞

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ó–∞–ø—É—Å–∫ —Ñ–ª–æ—É –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
**–ù–∞—Å—Ç—Ä–æ–π–∫–∏**:

- –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ: `0 10 * * 1` (–∫–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 10:00)
- –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å: Europe/Moscow
- –í–∫–ª—é—á–µ–Ω: –î–∞

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**:

```json
{
  "trigger_time": "2025-01-20T10:00:00+03:00",
  "week_start": "2025-01-13",
  "week_end": "2025-01-19"
}
```

### 2. **Get Stream Configuration** üîß

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤
**–¢–∏–ø –Ω–æ–¥—ã**: HTTP Request
**URL**: `GET http://localhost:8000/api/v1/config/streams`
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:

- `active_only=true`

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**:

- Retry: 3 –ø–æ–ø—ã—Ç–∫–∏
- Timeout: 30 —Å–µ–∫—É–Ω–¥
- Fallback: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**:

```json
{
  "streams": [
    {
      "stream_id": 1,
      "name": "–û–∫—Ç—è–±—Ä—å 2025",
      "program_id": 1,
      "student_count": 25,
      "notification_settings": {
        "max_students_per_batch": 20,
        "language": "ru",
        "tone": "motivational"
      }
    }
  ]
}
```

### 3. **Loop Through Streams** üîÑ

**–û–ø–∏—Å–∞–Ω–∏–µ**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞–∂–¥–æ–≥–æ –ø–æ—Ç–æ–∫–∞ –æ—Ç–¥–µ–ª—å–Ω–æ
**–¢–∏–ø –Ω–æ–¥—ã**: Split In Batches
**–ù–∞—Å—Ç—Ä–æ–π–∫–∏**:

- Batch Size: 1
- Input: –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —à–∞–≥–∞

### 4. **Get Students for Stream** üë•

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø–æ—Ç–æ–∫–∞
**–¢–∏–ø –Ω–æ–¥—ã**: HTTP Request
**URL**: `GET http://localhost:8000/api/v1/students`
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:

- `stream_id={{ $json.stream_id }}`
- `active_only=true`
- `limit=100`

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**:

```json
{
  "students": [
    {
      "student_id": 1,
      "name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
      "telegram_user_id": 123456789,
      "telegram_username": "ivan_petrov"
    }
  ],
  "total": 25
}
```

### 5. **Get Weekly Facts for Each Student** üìä

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü–æ–ª—É—á–µ–Ω–∏–µ "—Ñ–∞–∫—Ç–æ–≤ –Ω–µ–¥–µ–ª–∏" –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞
**–¢–∏–ø –Ω–æ–¥—ã**: HTTP Request (–≤ —Ü–∏–∫–ª–µ)
**URL**: `GET http://localhost:8000/api/v1/students/{{ $json.student_id }}/facts`
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**:

- `week_start={{ $('Cron Trigger').item.json.week_start }}`
- `week_end={{ $('Cron Trigger').item.json.week_end }}`

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**:

- Retry: 2 –ø–æ–ø—ã—Ç–∫–∏
- Timeout: 15 —Å–µ–∫—É–Ω–¥
- Continue on error: –î–∞

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**:

```json
{
  "student_id": 1,
  "name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
  "facts": {
    "assignments": {
      "total": 5,
      "completed": 4,
      "average_grade": 85.5
    },
    "activity": {
      "messages_sent": 8,
      "last_activity": "2025-01-18T15:30:00Z"
    },
    "attendance": {
      "attendance_rate": 0.67
    }
  }
}
```

### 6. **Calculate Weekly Score** üßÆ

**–û–ø–∏—Å–∞–Ω–∏–µ**: –†–∞—Å—á–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥–∞ –¥–ª—è –≤—Å–µ—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –ø–æ—Ç–æ–∫–∞
**–¢–∏–ø –Ω–æ–¥—ã**: HTTP Request
**URL**: `POST http://localhost:8000/api/v1/rating/calculate`
**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞**:

```json
{
  "stream_id": "{{ $json.stream_id }}",
  "week_start": "{{ $('Cron Trigger').item.json.week_start }}",
  "week_end": "{{ $('Cron Trigger').item.json.week_end }}",
  "student_ids": "{{ $json.students.map(s => s.student_id) }}",
  "calculation_version": "1.0"
}
```

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**:

```json
{
  "calculation_id": "uuid-here",
  "results": [
    {
      "student_id": 1,
      "weekly_score": 83.2,
      "selected_for_notification": true,
      "notification_priority": "high",
      "explanation": "–°—Ç—É–¥–µ–Ω—Ç –ø–æ–∫–∞–∑–∞–ª –≤—ã—Å–æ–∫—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å"
    }
  ]
}
```

### 7. **Filter Selected Students** üîç

**–û–ø–∏—Å–∞–Ω–∏–µ**: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤, –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
**–¢–∏–ø –Ω–æ–¥—ã**: Filter
**–£—Å–ª–æ–≤–∏–µ**: `{{ $json.selected_for_notification === true }}`

### 8. **Apply Anti-Repeat Rules** üö´

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –∞–Ω—Ç–∏–ø–æ–≤—Ç–æ—Ä–æ–≤
**–¢–∏–ø –Ω–æ–¥—ã**: Code
**–õ–æ–≥–∏–∫–∞**:

```javascript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ä–∞—Å—Å—ã–ª–∫–∏
const lastNotification = await checkLastNotification(student_id);
const daysSinceLastNotification = calculateDays(lastNotification);

if (daysSinceLastNotification < 7) {
  return null; // –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞
}

return item;
```

### 9. **Limit Selection** üìè

**–û–ø–∏—Å–∞–Ω–∏–µ**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏
**–¢–∏–ø –Ω–æ–¥—ã**: Limit
**–ù–∞—Å—Ç—Ä–æ–π–∫–∏**:

- Limit: 20 (–∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–æ—Ç–æ–∫–∞)
- Sort by: weekly_score (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)

### 10. **Generate Personalized Messages** üí¨

**–û–ø–∏—Å–∞–Ω–∏–µ**: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
**–¢–∏–ø –Ω–æ–¥—ã**: HTTP Request
**URL**: `POST http://localhost:8000/api/v1/notifications/generate`
**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞**:

```json
{
  "student_id": "{{ $json.student_id }}",
  "weekly_score": "{{ $json.weekly_score }}",
  "explanation": "{{ $json.explanation }}",
  "template_type": "motivational",
  "language": "ru"
}
```

**–í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**:

```json
{
  "message_text": "–ü—Ä–∏–≤–µ—Ç, –ò–≤–∞–Ω! –¢–≤–æ—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ –±—ã–ª–∞ –æ—Ç–ª–∏—á–Ω–æ–π - 83.2 –±–∞–ª–ª–∞! –¢—ã –≤—ã–ø–æ–ª–Ω–∏–ª 4 –∏–∑ 5 –∑–∞–¥–∞–Ω–∏–π –∏ –∞–∫—Ç–∏–≤–Ω–æ —É—á–∞—Å—Ç–≤–æ–≤–∞–ª –≤ —á–∞—Ç–∞—Ö. –ü—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ! üöÄ",
  "message_type": "motivational",
  "personalization": {
    "name": "–ò–≤–∞–Ω",
    "score": 83.2,
    "achievements": ["high_activity", "good_grades"]
  }
}
```

### 11. **Send Telegram Notifications** üì±

**–û–ø–∏—Å–∞–Ω–∏–µ**: –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —á–µ—Ä–µ–∑ Telegram
**–¢–∏–ø –Ω–æ–¥—ã**: Telegram
**–ù–∞—Å—Ç—Ä–æ–π–∫–∏**:

- Bot Token: `{{ $vars.TELEGRAM_BOT_TOKEN }}`
- Chat ID: `{{ $json.telegram_user_id }}`
- Message: `{{ $json.message_text }}`

**–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**:

- Retry: 3 –ø–æ–ø—ã—Ç–∫–∏
- Timeout: 10 —Å–µ–∫—É–Ω–¥
- Continue on error: –î–∞

### 12. **Log Results** üìù

**–û–ø–∏—Å–∞–Ω–∏–µ**: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞—Å—Å—ã–ª–∫–∏
**–¢–∏–ø –Ω–æ–¥—ã**: HTTP Request
**URL**: `POST http://localhost:8000/api/v1/notifications/log`
**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞**:

```json
{
  "calculation_id": "{{ $('Calculate Weekly Score').item.json.calculation_id }}",
  "notification_results": "{{ $json }}",
  "sent_at": "{{ new Date().toISOString() }}"
}
```

### 13. **Send Summary to Admin** üìß

**–û–ø–∏—Å–∞–Ω–∏–µ**: –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–≤–æ–¥–∫–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
**–¢–∏–ø –Ω–æ–¥—ã**: Email
**–ù–∞—Å—Ç—Ä–æ–π–∫–∏**:

- To: `admin@tutorai.com`
- Subject: `Weekly Score Report - {{ new Date().toLocaleDateString() }}`
- Body: `–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: {{ $json.length }} —Å—Ç—É–¥–µ–Ω—Ç–∞–º`

## üé® –í–∏–∑—É–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ —Ñ–ª–æ—É

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Cron Trigger  ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ Get Stream Config   ‚îÇ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ  Loop Streams      ‚îÇ
‚îÇ   (Weekly)      ‚îÇ    ‚îÇ                     ‚îÇ    ‚îÇ                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                              ‚îÇ
                                                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Log Results   ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÇ Send Telegram       ‚îÇ‚óÄ‚îÄ‚îÄ‚îÄ‚îÇ Generate Messages  ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ Notifications        ‚îÇ    ‚îÇ                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚ñ≤                        ‚ñ≤                           ‚ñ≤
         ‚îÇ                        ‚îÇ                           ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Send Summary    ‚îÇ    ‚îÇ Apply Anti-Repeat    ‚îÇ    ‚îÇ Filter Selected     ‚îÇ
‚îÇ to Admin        ‚îÇ    ‚îÇ Rules                ‚îÇ    ‚îÇ Students            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚ñ≤                        ‚ñ≤                           ‚ñ≤
         ‚îÇ                        ‚îÇ                           ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 ‚îÇ    ‚îÇ Limit Selection      ‚îÇ    ‚îÇ Calculate Weekly    ‚îÇ
‚îÇ                 ‚îÇ    ‚îÇ (Max 20 students)    ‚îÇ    ‚îÇ Score               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                              ‚ñ≤
                                                              ‚îÇ
                                                              ‚ñº
                                                       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                                       ‚îÇ Get Students for    ‚îÇ
                                                       ‚îÇ Stream              ‚îÇ
                                                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ n8n –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–µ–∫—Ç–æ–º

### 1. **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è**

#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ n8n

```bash
# –ß–µ—Ä–µ–∑ npm
npm install n8n -g

# –ß–µ—Ä–µ–∑ Docker
docker run -it --rm --name n8n -p 5678:5678 n8nio/n8n
```

#### –î–æ—Å—Ç—É–ø –∫ n8n

- URL: `http://n8n.kyter.space` (—É–∫–∞–∑–∞–Ω–Ω—ã–π –≤ –∑–∞–¥–∞–Ω–∏–∏)
- –ò–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ: `http://localhost:5678`

### 2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è**

#### –í n8n Settings ‚Üí Variables:

```json
{
  "TUTORAI_API_URL": "http://localhost:8000",
  "TELEGRAM_BOT_TOKEN": "your-bot-token",
  "ADMIN_EMAIL": "admin@tutorai.com",
  "DEFAULT_LANGUAGE": "ru",
  "MAX_STUDENTS_PER_BATCH": "20"
}
```

### 3. **–°–æ–∑–¥–∞–Ω–∏–µ —Ñ–ª–æ—É**

#### –ò–º–ø–æ—Ä—Ç —Ñ–ª–æ—É

1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ñ–ª–æ—É –≤ n8n
2. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å JSON –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Ñ–ª–æ—É
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –Ω–æ–¥—ã –ø–æ–¥ –≤–∞—à–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–æ–¥

- **HTTP Request –Ω–æ–¥—ã**: –£–∫–∞–∑–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL API
- **Telegram –Ω–æ–¥—ã**: –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
- **Email –Ω–æ–¥—ã**: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SMTP
- **Cron –Ω–æ–¥—ã**: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ

### 4. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–ª–æ—É**

#### –†–µ–∂–∏–º "—Å—É—Ö–æ–≥–æ –ø—Ä–æ–≥–æ–Ω–∞"

```json
{
  "dry_run": true,
  "test_mode": true,
  "log_level": "debug"
}
```

#### –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø–æ—Ç–æ–∫ —Å 5-10 —Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —ç—Ç–∞–ø—ã —Ñ–ª–æ—É
- –£–±–µ–¥–∏—Ç—å—Å—è –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ —Ä–∞—Å—á–µ—Ç–æ–≤

### 5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

- Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

#### –ú–µ—Ç—Ä–∏–∫–∏

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–ª–æ—É
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –û—à–∏–±–∫–∏ –∏ –∏—Ö —á–∞—Å—Ç–æ—Ç–∞

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞

- **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ**: –ö–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 10:00
- **–ü–µ—Ä–∏–æ–¥**: –ü—Ä–µ–¥—ã–¥—É—â–∞—è –Ω–µ–¥–µ–ª—è
- **–õ–∏–º–∏—Ç**: 20 —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
- **–¢–æ–Ω**: –ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω—ã–π

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

- **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ**: –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 9:00
- **–ü–µ—Ä–∏–æ–¥**: –í—á–µ—Ä–∞—à–Ω–∏–π –¥–µ–Ω—å
- **–õ–∏–º–∏—Ç**: 10 —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
- **–¢–æ–Ω**: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

- **–¢—Ä–∏–≥–≥–µ—Ä**: –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
- **–ü–µ—Ä–∏–æ–¥**: –ü–æ—Å–ª–µ–¥–Ω–∏–µ 3 –¥–Ω—è
- **–õ–∏–º–∏—Ç**: 50 —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
- **–¢–æ–Ω**: –°—Ä–æ—á–Ω—ã–π

## üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –¢–∏–ø—ã –æ—à–∏–±–æ–∫ –∏ –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∞

1. **API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω**: Retry + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
2. **–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞**: –ü—Ä–æ–ø—É—Å–∫ —Å—Ç—É–¥–µ–Ω—Ç–∞ + –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
3. **–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏**: Retry + –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∫–∞–Ω–∞–ª
4. **–ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∫–∏

### Fallback —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

- –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–∞–Ω–∞–ª—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –£–ø—Ä–æ—â–µ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
- –†—É—á–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏

- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–ª–æ—É
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
- –£—Å–ø–µ—à–Ω–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –¢–æ—á–Ω–æ—Å—Ç—å —Ä–∞—Å—á–µ—Ç–æ–≤ —Ä–µ–π—Ç–∏–Ω–≥–∞

### –î–∞—à–±–æ—Ä–¥ n8n

- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –ì—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –õ–æ–≥–∏ –æ—à–∏–±–æ–∫
- –°—Ç–∞—Ç—É—Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
